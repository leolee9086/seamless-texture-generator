# 高级灰度合成器 (Advanced Grayscale Compositor)

## 核心设计理念

**“为什么我们需要在这个工具中内置一个高级合成器？”**

在传统的程序化纹理工作流中，美术师经常需要在外部图像处理软件（如 Photoshop）和纹理生成工具之间反复切换。为了处理一张遮罩、提取一个特定区域的高光，或者融合两个材质的纹理，往往需要中断当前的创作心流。

本工具旨在解决这一痛点，提供一个**轻量级但逻辑强大**的合成环境，专门针对 PBR 纹理流程中的**灰度图处理**（高度图、粗糙度图、遮罩图）进行优化。

### 核心价值

1.  **非破坏性的程序化工作流 (Non-Destructive Procedural Workflow)**
    *   **逻辑优先**：不同于基于像素的擦除，我们的蒙版系统基于**HSL 色彩逻辑**生成。这意味着当你更换源图片时，蒙版规则（例如“提取红色区域”）依然有效，能够自动适应新的素材。
    *   **快速迭代**：支持一键替换图层源图片，同时保留所有的混合模式、透明度和遮罩规则。极其适合快速尝试不同的纹理素材而不必重新制作遮罩。

2.  **专为 PBR 准备 (Pre-processing for PBR)**
    *   **灰度精准控制**：通过精确的 HSL 选取和图层混合，用户可以轻松从复杂的照片素材中提取出干净的灰度信息，为生成高质量的法线贴图 (Normal Map) 和置换贴图 (Displacement Map) 打下基础。
    *   **多通渲染**：支持多层叠加，模拟复杂的磨损、污渍或细节融合效果。

3.  **零上下文切换 (Zero Context Switching)**
    *   无需打开外部大型软件，直接在浏览器端完成从“素材导入”到“纹理合成”的闭环。
    *   实时 WebGPU 预览，所见即所得。

## 功能特性

-   **多图层合成**：支持无限层级的纹理叠加。
-   **智能蒙版 (HSL Keying)**：
    -   支持基于 **自身(Self)** 或 **底图(Base)** 的色彩范围进行遮罩生成。
    -   每个图层支持多条蒙版规则叠加。
-   **混合模式**：支持标准的 Photoshop 级混合模式（Normal, Add, Multiply, Screen, Overlay）。
-   **快速操作**：
    -   🔃 **快速换图**：保留参数，仅替换纹理。
    -   📄 **图层复制**：快速复用复杂的混合设置。
    -   ⬆️⬇️ **图层排序**：灵活调整合成顺序。
