# UnoCSS 动态图标类无法显示的问题修复记录

## 问题描述

在 Vue 3 + UnoCSS 项目中，部分图标无法显示。具体表现为：

- 通过 `:class="[group.icon]"` 动态绑定的图标不显示
- 直接在模板中硬编码的图标类（如 `i-carbon-logo-github`）可以正常显示
- 构建后的 CSS 中缺少动态绑定的图标类

## 问题分析

### 1. 初步排查

首先检查了常见原因：

1. **图标资源路径**：确认 `@iconify-json/carbon` 已安装，本地图标集存在
2. **UnoCSS 配置**：`presetIcons` 配置正确，设置了 `cdn: false` 和本地图标集
3. **网络请求**：通过构建后的 CSS 确认图标已内联为 SVG，不存在网络请求问题
4. **全局样式**：检查了全局 CSS，没有覆盖图标样式的规则

### 2. 根本原因

通过检查构建后的 CSS 文件，发现：

- 直接在模板中使用的图标类（如 `i-carbon-logo-github`）已生成 CSS
- 动态绑定的图标类（如 `i-carbon-favorite`）未生成 CSS

原因：UnoCSS 的静态扫描器无法检测到 JavaScript/TypeScript 文件中动态绑定的类名。即使这些类名是字符串字面量，但由于它们存储在数组中并通过动态绑定使用，扫描器会跳过。

## 解决方案

在 `uno.config.ts` 中使用 `safelist` 选项，强制包含这些动态图标类：

```ts
export default defineConfig({
    presets: [
        presetUno(),
        presetAttributify(),
        presetIcons({
            scale: 1.2,
            warn: true,
            cdn: false,
            collections: {
                carbon: () => import('@iconify-json/carbon/icons.json').then(i => i.default),
            },
        }),
    ],
    safelist: [
        // 强制包含这些图标类，因为它们是动态绑定的
        'i-carbon-favorite',
        'i-carbon-image-search',
        'i-carbon-crop',
        'i-carbon-settings-adjust',
        'i-carbon-view',
        'i-carbon-save',
    ],
    // ... 其他配置
})
```

## 验证

重新构建项目后，检查生成的 CSS 文件，确认所有图标类都已包含。

## 经验总结

1. **UnoCSS 扫描限制**：静态扫描器无法处理动态类绑定，即使类名是字面量
2. **safelist 用法**：对于动态生成的类名，应使用 `safelist` 确保生成 CSS
3. **调试方法**：通过检查构建后的 CSS 文件，可以快速确认哪些类被生成
4. **本地图标集**：配置 `cdn: false` 可以避免网络依赖，提高可靠性

## 扩展思考

对于类似问题，还可以考虑：

1. **使用 UnoCSS 的 `extractors`**：自定义提取器可以处理更复杂的动态类场景
2. **运行时检查**：在开发环境中添加警告，检测动态类是否生成 CSS
3. **类型安全**：通过 TypeScript 枚举确保图标类名的正确性

这次修复提醒我们，在使用原子化 CSS 框架时，需要理解其扫描机制，对于动态内容要采取额外措施。